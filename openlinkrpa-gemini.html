<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç‹¬ç«‹å¼¹çª—è½®è½¬å·¥å…· v1.2</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            margin: 0;
        }
        /* ç‰ˆæœ¬æ ‡è®° */
        .version-tag {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 12px;
            color: #999;
            font-family: monospace;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 650px;
            z-index: 10;
            position: relative;
        }
        h2 { color: #2c3e50; margin-top: 0; border-bottom: 2px solid #4a90e2; padding-bottom: 10px; }
        textarea {
            width: 100%;
            height: 180px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            margin-top: 10px;
        }
        .controls {
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        button:hover { background-color: #357abd; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .status-badge {
            background: #f0f7ff;
            color: #4a90e2;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .info-box {
            margin-top: 25px;
            padding: 15px;
            background-color: #fff9db;
            border-left: 4px solid #fcc419;
            font-size: 13px;
            color: #856404;
            line-height: 1.6;
        }
        /* å…¨å±äº¤äº’é®ç½©å±‚ */
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.9);
            z-index: 999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .instruction-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .key-hint {
            display: inline-block;
            padding: 4px 10px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="version-tag">Version 1.2 (Auto-Close Enabled)</div>
    <h2>ğŸ“‘ ç½‘é¡µè½®è½¬å®¡é˜…å·¥å…·</h2>
    <textarea id="linksInput" placeholder="åœ¨æ­¤ç²˜è´´é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
    
    <div class="controls">
        <button id="startBtn">å¼€å§‹å®¡é˜…</button>
        <span id="progressText" class="status-badge">ç­‰å¾…ä»»åŠ¡</span>
    </div>

    <div class="info-box">
        <strong>ğŸ†• v1.2 æ›´æ–°ç‰¹æ€§ï¼š</strong><br>
        â€¢ <b>è‡ªåŠ¨æ¸…ç†ï¼š</b>æŒ‰ä¸‹ç»§ç»­é”®åï¼Œç¨‹åºä¼š<b>è‡ªåŠ¨å…³é—­</b>ä¸Šä¸€ä¸ªå¼¹çª—å†æ‰“å¼€ä¸‹ä¸€ä¸ªã€‚<br>
        â€¢ <b>ä¸“æ³¨æ¨¡å¼ï¼š</b>å§‹ç»ˆåªä¿æŒä¸€ä¸ªé¢„è§ˆçª—å£ï¼Œé¿å…æ¡Œé¢æ‹¥æŒ¤ã€‚<br>
        â€¢ <b>æ“ä½œè¯´æ˜ï¼š</b>åˆ‡å›æœ¬é¡µåæŒ‰ <span class="key-hint">ç©ºæ ¼/å›è½¦</span> æˆ– <span class="key-hint">ç‚¹å‡»ä»»æ„å¤„</span> å³å¯åˆ‡æ¢ã€‚
    </div>
</div>

<div id="overlay">
    <div class="instruction-card">
        <h2 style="border:none">å·²æš‚åœ</h2>
        <p style="font-size: 18px;">ç‚¹å‡»æˆ–æŒ‰ä»»æ„é”®ï¼š<br><b style="color: #e67e22;">å…³é—­å½“å‰çª—å£å¹¶è¿›å…¥ä¸‹ä¸€ä¸ª</b></p>
        <div style="margin-top:20px; color:#7f8c8d;">
            è¿›åº¦: <span id="currentCount">0</span> / <span id="totalCount">0</span>
        </div>
    </div>
</div>

<script>
    const linksInput = document.getElementById('linksInput');
    const startBtn = document.getElementById('startBtn');
    const progressText = document.getElementById('progressText');
    const overlay = document.getElementById('overlay');
    const currentCountSpan = document.getElementById('currentCount');
    const totalCountSpan = document.getElementById('totalCount');

    let links = [];
    let currentIndex = 0;
    let isRunning = false;
    let currentPopup = null; // ç”¨äºå­˜å‚¨å½“å‰æ‰“å¼€çª—å£çš„å¼•ç”¨

    const windowFeatures = "width=1200,height=800,top=50,left=50,scrollbars=yes,resizable=yes";

    function updateUI() {
        if (currentIndex < links.length) {
            const current = currentIndex + 1;
            progressText.innerText = `æ­£åœ¨æµè§ˆ: ${current} / ${links.length}`;
            currentCountSpan.innerText = current;
            totalCountSpan.innerText = links.length;
        } else {
            progressText.innerText = "ğŸ‰ å®¡é˜…å·²å…¨éƒ¨å®Œæˆ";
            stop();
        }
    }

    function openNext() {
        if (!isRunning || currentIndex >= links.length) return;

        // --- æ ¸å¿ƒé€»è¾‘ï¼šå…³é—­ä¹‹å‰çš„çª—å£ ---
        if (currentPopup && !currentPopup.closed) {
            currentPopup.close();
        }

        const url = links[currentIndex].trim();
        if (url) {
            // æ‰“å¼€æ–°çª—å£å¹¶ä¿å­˜å¼•ç”¨
            currentPopup = window.open(url, "ReviewWindow", windowFeatures);
            
            // å¦‚æœæµè§ˆå™¨æ‹¦æˆªäº†å¼¹çª—
            if (!currentPopup) {
                alert("å¼¹çª—è¢«æµè§ˆå™¨æ‹¦æˆªï¼Œè¯·åœ¨åœ°å€æ å³ä¾§é€‰æ‹©â€˜å§‹ç»ˆå…è®¸â€™åå†è¯•ã€‚");
                stop();
                return;
            }

            currentIndex++;
            updateUI();
        }
    }

    function start() {
        const text = linksInput.value.trim();
        if (!text) return;

        links = text.split(/\n/).filter(line => line.trim().startsWith('http'));
        
        if (links.length === 0) {
            alert("æœªå‘ç°æœ‰æ•ˆé“¾æ¥ï¼");
            return;
        }

        isRunning = true;
        currentIndex = 0;
        startBtn.disabled = true;
        linksInput.disabled = true;
        
        openNext();
        
        if (currentIndex < links.length) {
            overlay.style.display = 'flex';
        }
    }

    function stop() {
        // æœ€åå®Œæˆåæ˜¯å¦å…³é—­æœ€åä¸€ä¸ªçª—å£å¯æ ¹æ®éœ€æ±‚è°ƒæ•´
        // if (currentPopup && !currentPopup.closed) currentPopup.close();
        
        isRunning = false;
        startBtn.disabled = false;
        linksInput.disabled = false;
        overlay.style.display = 'none';
        currentPopup = null;
    }

    function handleTrigger(e) {
        if (!isRunning) return;
        if (e.type === 'keydown') e.preventDefault();

        // ç‚¹å‡»æˆ–æŒ‰é”®åï¼Œæ‰§è¡Œå¼€å¯ä¸‹ä¸€ä¸ªçš„æ“ä½œ
        if (currentIndex < links.length) {
            openNext();
        } else {
            // å¦‚æœå·²ç»æ˜¯æœ€åä¸€ä¸ªï¼Œå…³é—­æœ€åä¸€ä¸ªçª—å£å¹¶ç»“æŸ
            if (currentPopup && !currentPopup.closed) currentPopup.close();
            stop();
        }
    }

    window.addEventListener('keydown', handleTrigger);
    overlay.addEventListener('mousedown', handleTrigger);
    startBtn.addEventListener('click', start);
</script>

</body>
</html>
