<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç‹¬ç«‹å¼¹çª—è½®æ¢å·¥å…· v1.3 (Excelç‰ˆ)</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f8fafc;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            margin: 0;
        }
        .version-tag {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 12px;
            color: #94a3b8;
            font-family: monospace;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 650px;
            z-index: 10;
            position: relative;
            border: 1px solid #e2e8f0;
        }
        h2 { color: #1e293b; margin-top: 0; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
        
        /* Excel ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-area {
            border: 2px dashed #cbd5e1;
            padding: 40px 20px;
            text-align: center;
            border-radius: 12px;
            background: #f1f5f9;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        .upload-area:hover { background: #e2e8f0; border-color: #3b82f6; }
        .upload-area p { margin: 10px 0 0; color: #64748b; }
        #fileInput { display: none; }

        .controls {
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.4);
        }
        button:hover { background-color: #2563eb; }
        button:disabled { background-color: #94a3b8; cursor: not-allowed; box-shadow: none; }
        
        .status-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 6px 16px;
            border-radius: 99px;
            font-size: 14px;
            font-weight: 500;
        }
        .info-box {
            margin-top: 25px;
            padding: 15px;
            background-color: #fefce8;
            border-left: 4px solid #eab308;
            font-size: 13px;
            color: #854d0e;
            line-height: 1.6;
        }

        /* äº¤äº’é®ç½©å±‚ */
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.85);
            z-index: 999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }
        .instruction-card {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div class="container">
    <div class="version-tag">Version 1.3 (Excel Import Enabled)</div>
    <h2>ğŸ“Š ç½‘é¡µè½®è½¬å®¡é˜…å·¥å…·</h2>
    
    <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
        <div style="font-size: 40px;">ğŸ“</div>
        <p id="fileNameDisplay">ç‚¹å‡»æ­¤å¤„ä¸Šä¼  Excel æ–‡ä»¶ (.xlsx / .xls)</p>
        <p style="font-size: 12px; color: #94a3b8;">ç¨‹åºå°†è‡ªåŠ¨è¯»å–è¡¨æ ¼ä¸­ç¬¬ä¸€åˆ—çš„æ‰€æœ‰é“¾æ¥</p>
        <input type="file" id="fileInput" accept=".xlsx, .xls">
    </div>
    
    <div class="controls">
        <button id="startBtn" disabled>è¯·å…ˆä¸Šä¼ æ–‡ä»¶</button>
        <span id="progressText" class="status-badge">ç­‰å¾…æ•°æ®...</span>
    </div>

    <div class="info-box">
        <strong>ğŸš€ v1.3 æ›´æ–°ç‰¹æ€§ï¼š</strong><br>
        â€¢ <b>Excel é©±åŠ¨ï¼š</b>æ— éœ€å¤åˆ¶ç²˜è´´ï¼Œç›´æ¥å¯¼å…¥è¡¨æ ¼å³å¯å¼€å§‹ã€‚<br>
        â€¢ <b>æ™ºèƒ½æå–ï¼š</b>è‡ªåŠ¨è¯†åˆ«ç¬¬ä¸€å¼ å·¥ä½œè¡¨ï¼ˆSheetï¼‰çš„ç¬¬ä¸€åˆ—é“¾æ¥ã€‚<br>
        â€¢ <b>æ“ä½œæµï¼š</b>å¯¼å…¥ â†’ å¼¹çª—é¢„è§ˆ â†’ <b>åˆ‡å›æœ¬é¡µæŒ‰é”®/ç‚¹å‡»</b> â†’ æ—§çª—å£å…³é—­å¹¶åˆ‡æ¢ä¸‹ä¸€ä¸ªã€‚
    </div>
</div>

<div id="overlay">
    <div class="instruction-card">
        <h2 style="border:none; color:#1e293b">é˜…è§ˆä¸­...</h2>
        <p style="font-size: 18px; color: #475569;">
            æ“ä½œæç¤ºï¼š<br>
            <span style="color: #3b82f6; font-weight: bold;">æŒ‰ä¸‹ä»»æ„é”®</span> æˆ– <span style="color: #3b82f6; font-weight: bold;">ç‚¹å‡»æ­¤å¤„</span><br>
            å³å¯å…³é—­å½“å‰çª—å£å¹¶åˆ‡æ¢ä¸‹ä¸€ä¸ª
        </p>
        <div style="margin-top:30px; padding: 10px; background: #f1f5f9; border-radius: 12px; color:#64748b;">
            å½“å‰è¿›åº¦: <span id="currentCount" style="color:#1e293b; font-weight:bold;">0</span> / <span id="totalCount">0</span>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const startBtn = document.getElementById('startBtn');
    const progressText = document.getElementById('progressText');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const overlay = document.getElementById('overlay');
    const currentCountSpan = document.getElementById('currentCount');
    const totalCountSpan = document.getElementById('totalCount');

    let links = [];
    let currentIndex = 0;
    let isRunning = false;
    let currentPopup = null;

    const windowFeatures = "width=1280,height=900,top=50,left=50,scrollbars=yes,resizable=yes";

    // --- Excel æ–‡ä»¶å¤„ç†é€»è¾‘ ---
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        fileNameDisplay.innerText = "æ­£åœ¨è¯»å–: " + file.name;
        
        const reader = new FileReader();
        reader.onload = function(evt) {
            const data = evt.target.result;
            const workbook = XLSX.read(data, { type: 'binary' });
            
            // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // è½¬æ¢ä¸º JSON (å–ç¬¬ä¸€åˆ—)
            const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            // æå–æ‰€æœ‰ä»¥ http å¼€å¤´çš„å•å…ƒæ ¼å†…å®¹
            links = json.map(row => row[0]) // åªçœ‹ç¬¬ä¸€åˆ—
                        .filter(cell => cell && typeof cell === 'string' && cell.trim().startsWith('http'));

            if (links.length > 0) {
                progressText.innerText = `å·²è½½å…¥ ${links.length} æ¡é“¾æ¥`;
                startBtn.disabled = false;
                startBtn.innerText = "å¼€å§‹æ‰§è¡Œä»»åŠ¡";
                fileNameDisplay.innerHTML = `âœ… å·²å°±ç»ª: ${file.name}<br><small>${links.length} ä¸ªé“¾æ¥</small>`;
            } else {
                alert("åœ¨è¡¨æ ¼ç¬¬ä¸€åˆ—æ²¡æ‰¾åˆ°ä»»ä½•é“¾æ¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼");
                fileNameDisplay.innerText = "æ–‡ä»¶æ— æ•ˆï¼Œè¯·é‡æ–°ä¸Šä¼ ";
                startBtn.disabled = true;
            }
        };
        reader.readAsBinaryString(file);
    });

    function updateUI() {
        if (currentIndex < links.length) {
            const current = currentIndex + 1;
            progressText.innerText = `æ‰§è¡Œä¸­: ${current} / ${links.length}`;
            currentCountSpan.innerText = current;
            totalCountSpan.innerText = links.length;
        } else {
            progressText.innerText = "âœ… ä»»åŠ¡å®Œæˆ";
            stop();
        }
    }

    function openNext() {
        if (!isRunning || currentIndex >= links.length) return;

        // è‡ªåŠ¨å…³é—­ä¸Šä¸€ä¸ª
        if (currentPopup && !currentPopup.closed) {
            currentPopup.close();
        }

        const url = links[currentIndex].trim();
        currentPopup = window.open(url, "ReviewWindow", windowFeatures);

        if (!currentPopup) {
            alert("è¯·å…è®¸å¼¹å‡ºçª—å£ï¼");
            stop();
            return;
        }

        currentIndex++;
        updateUI();
    }

    function start() {
        if (links.length === 0) return;

        isRunning = true;
        currentIndex = 0;
        startBtn.disabled = true;
        fileInput.disabled = true;
        
        openNext();
        
        if (currentIndex < links.length) {
            overlay.style.display = 'flex';
        }
    }

    function stop() {
        isRunning = false;
        startBtn.disabled = false;
        fileInput.disabled = false;
        overlay.style.display = 'none';
        currentPopup = null;
    }

    function handleTrigger(e) {
        if (!isRunning) return;
        if (e.type === 'keydown') e.preventDefault();

        if (currentIndex < links.length) {
            openNext();
        } else {
            if (currentPopup && !currentPopup.closed) currentPopup.close();
            stop();
        }
    }

    window.addEventListener('keydown', handleTrigger);
    overlay.addEventListener('mousedown', handleTrigger);
    startBtn.addEventListener('click', start);
</script>

</body>
</html>
